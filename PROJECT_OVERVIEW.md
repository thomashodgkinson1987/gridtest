<overview>
# Project Overview: GridTest

## 1. High-Level Summary

-   **Project:** GridTest, a rogikuelike prototype written in C.
-   **Developer:** Thomas Hodgkinson (Tom)
-   **Email:** thomashodgkinson1987@gmail.com
-   **Core Philosophy:** "Productive Laziness" - building a clean, maintainable, and well-documented project now to save time and effort later.

## 2. Architecture

-   **Model:** A pragmatic, layered **Actor Model**. It is not a pure Entity-Component-System (ECS).
-   **Core Objects:** `Actor` structs are concrete objects with intrinsic properties (`x`, `y`, `glyph`, `colour`, `name`) and optional `Components` for extensible data (health, combat, AI).
-   **Game Loop:** The engine is built on a **Command/Result Pattern**.
    -   Gameplay logic generates "Commands" (atomic state changes).
    -   A central queue in the `game` module holds these commands.
    -   A `command_execute` function processes commands and returns a "Result" object.
    -   The main game loop inspects the `Result` to handle consequences (e.g., actor death, dirtying the renderer).

## 3. Project Conventions

-   **API Design:** Prefer passing explicit context (e.g., `Game*`, `Renderer*`) over using singletons. Strive for `const`-correctness with both `const` and `_mut` variants for getters where appropriate.
-   **Memory Management:** Ownership is clear and encapsulated. `_create` functions `malloc`, and corresponding `_free` functions `free`. The calling code does not manage memory for objects it receives.
-   **Formatting:** Adhere to an 80-column limit. Use include guards and a standard include order (primary header, system headers, library headers, project headers).
-   **Git Workflow:** See section below.

### Task-Based Workflow

Our collaboration follows a structured, task-based workflow managed via `PLAN.md`.

1.  **Initiate Task:** We will review the task group in `PLAN.md` to ensure we are synchronized.
2.  **Execute Sub-Tasks:** We will work through each sub-task sequentially.
3.  **Update Plan:** We will keep `PLAN.md` updated by marking tasks as `[Doing]` when active and `[Done]` upon completion. The parent task group is marked `[Done]` only when all its sub-tasks are finished.

## 4. Git & Repository

-   **URLs:**
    -   Main Project: `https://github.com/thomashodgkinson1987/gridtest.git`
    -   `array_macros` Submodule: `https://github.com/thomashodgkinson1987/array_macros.git`
-   **Branching:** All work is done on feature/fix/chore branches, branched from `develop`.
-   **Commits:** All commit messages must adhere to the **Conventional Commits** specification. We practice creating **atomic commits** where it adds clarity.
-   **Merging:**
    -   Features are merged into `develop` using a **squash merge**.
    -   `develop` is merged into `main` for releases using a **`--no-ff` merge**.
    -   A "back-merge" from `main` to `develop` is performed after releases to keep branches synchronized.

### Build & Run Workflow

This project uses a CMake configuration that simplifies the build and run process.

-   **Build:** To compile the project, press `F7` in VS Code, or run the following command in the terminal:
    ```bash
    cmake --build build-Debug
    ```
-   **Run (Recommended):** To build and run the application with the correct working directory, use the custom `run` target. This is the preferred method for command-line execution.
    ```bash
    cmake --build build-Debug --target run
    ```
-   **Debug:** To launch a debugging session (which correctly sets the working directory), press `F5` in VS Code.

### Managing Metadata (`PLAN.md`, `NOTES.md`)

To keep the `develop` branch history clean and contextually relevant, changes to metadata files are committed as part of the feature lifecycle, not in separate commits.

1.  **Start of Task:** On a new feature branch, the *first commit* should be an update to `PLAN.md`, marking the current task as `[Doing]`.
2.  **End of Task:** Before merging, make a final commit on the feature branch that updates `PLAN.md` to mark the task as `[Done]`.
3.  **Squash and Merge:** When the feature branch is squashed and merged, all changes—including the initial and final plan updates—are bundled into a single, clean commit on `develop`. This ensures the plan always reflects the state of the codebase at the time of the merge.
</overview>

## 5. Directory Structure

The project is organized into the following key directories:

-   `/src/`: Contains all the core C source files (.c).
-   `/include/`: Contains all the public header files (.h) that make up the modules' APIs.
-   `/lib/`: Contains pre-compiled third-party libraries (e.g., Raylib).
-   `/vendor/`: Contains third-party source code managed as Git submodules (e.g., array_macros).
-   `/res/`: Contains game assets like fonts and images.
-   `/.vscode/`: Contains project-specific settings and launch configurations for VS Code.
-   `/build-*/`: Build output directories (generated by CMake, ignored by Git).
</overview>